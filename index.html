<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="å€’ç­ä¸‡å¹´å†">
<meta name="theme-color" content="#6750A4">
<title>å€’ç­ä¸‡å¹´å†</title>
<style>
:root{
  --bg:#FEFBFF;--sf:#FFF;--tx:#1C1B1F;--tx2:#49454F;
  --ol:#CAC4D0;--re:#B00020;--gr:#2E7D32;--bl:#1565C0;
  --tbg:#6750A4;--ttt:#FFF;--ck:#E8DEF8;--cs:#6750A4;--cst:#FFF;--sh:#F4F2F8;
}
[data-theme=dark]{
  --bg:#1C1B1F;--sf:#2B2930;--tx:#E6E1E5;--tx2:#CAC4D0;
  --ol:#49454F;--re:#FFB4AB;--gr:#81C784;--bl:#90CAF9;
  --tbg:#4A4458;--ttt:#E6E1E5;--ck:#4A4458;--cs:#D0BCFF;--cst:#381E72;--sh:#3A3840;
}
*{box-sizing:border-box;-webkit-tap-highlight-color:transparent;margin:0;padding:0}
body{font-family:-apple-system,'Roboto','Droid Sans','Noto Sans CJK SC',sans-serif;background:var(--bg);color:var(--tx);min-height:100vh;overscroll-behavior:none}

/* â”€â”€ Header â”€â”€ */
header{background:var(--tbg);color:var(--ttt);padding:9px 8px;display:flex;align-items:center;position:sticky;top:0;z-index:100;box-shadow:0 2px 8px rgba(0,0,0,.25)}
.nav-btn{background:none;border:none;color:var(--ttt);font-size:26px;cursor:pointer;padding:4px 10px;border-radius:50%;line-height:1;flex-shrink:0;transition:background .15s}
.nav-btn:active{background:rgba(255,255,255,.2)}
.hdr-mid{flex:1;display:flex;align-items:center;justify-content:center;gap:4px}
.month-title{font-size:16px;font-weight:700;cursor:pointer;padding:5px 9px;border-radius:10px;display:flex;align-items:center;gap:4px;white-space:nowrap;transition:background .15s}
.month-title:active{background:rgba(255,255,255,.15)}
.arr{font-size:11px;opacity:.7}
.icon-btn{background:none;border:none;color:var(--ttt);font-size:19px;cursor:pointer;padding:7px;border-radius:50%;line-height:1;flex-shrink:0;transition:background .15s}
.icon-btn:active{background:rgba(255,255,255,.2)}

/* â”€â”€ Chip bar â”€â”€ */
.bar{display:flex;gap:5px;padding:7px 10px;overflow-x:auto;background:var(--sf);border-bottom:1px solid var(--ol);scrollbar-width:none;align-items:center;flex-shrink:0}
.bar::-webkit-scrollbar{display:none}
.chip{display:inline-flex;align-items:center;gap:3px;padding:5px 12px;border-radius:20px;border:1.5px solid var(--ol);background:var(--bg);color:var(--tx);font-size:14px;font-weight:600;cursor:pointer;white-space:nowrap;user-select:none;flex-shrink:0;transition:all .15s}
.chip.on{background:var(--cs);color:var(--cst);border-color:var(--cs)}
.chip:active{opacity:.7}
.bsep{width:1px;height:20px;background:var(--ol);flex-shrink:0;margin:0 2px}
.set-btn{display:inline-flex;align-items:center;gap:4px;padding:5px 11px;border-radius:20px;border:1.5px solid var(--ol);background:var(--bg);color:var(--tx2);font-size:14px;font-weight:600;cursor:pointer;white-space:nowrap;flex-shrink:0;transition:background .15s}
.set-btn:active{opacity:.7}

/* â”€â”€ Week row (Mon first) â”€â”€ */
.dow-row{display:grid;grid-template-columns:repeat(7,1fr);background:var(--sf);border-bottom:1px solid var(--ol)}
.dow-cell{text-align:center;padding:7px 0;font-size:14px;font-weight:700;color:var(--tx2)}
.dow-cell.sat{color:var(--bl)}
.dow-cell.sun{color:var(--re)}

/* â”€â”€ Calendar grid â”€â”€ */
.cal{display:grid;grid-template-columns:repeat(7,1fr)}
.day{min-height:96px;padding:5px 4px 3px;border-right:1px solid var(--ol);border-bottom:1px solid var(--ol);cursor:pointer;position:relative;overflow:hidden;transition:background .12s}
.day:nth-child(7n){border-right:none}
.day.other{opacity:.28}
.day.today{background:var(--ck)}
.day.selected{background:var(--ck);outline:2px solid var(--cs);outline-offset:-2px;z-index:1}
.day:active{background:var(--ol)}
.dn{font-size:17px;font-weight:700;line-height:1.2}
.day.sat .dn{color:var(--bl)}
.day.sun .dn{color:var(--re)}
/* è°ƒä¼‘ä¸Šç­ï¼šå³ä¾¿æ˜¯å‘¨æœ«ä¹Ÿä¸çº¢/è“ */
.day.work-day .dn{color:var(--tx)!important}
.lun{font-size:12px;color:var(--tx2);line-height:1.3;margin-bottom:2px;white-space:nowrap;overflow:hidden}
.term-lbl{color:var(--gr);font-weight:700}
.hol-name{font-size:11px;color:var(--re);font-weight:700;line-height:1.3;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.work-lbl{font-size:11px;color:var(--re);font-weight:700}
.hol-dot{position:absolute;top:5px;right:5px;width:7px;height:7px;border-radius:50%;background:var(--re)}
.stags{display:flex;flex-direction:column;gap:2px;margin-top:2px}
.st{font-size:12px;font-weight:700;padding:2px 5px;border-radius:5px;line-height:1.4;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.sD{background:#FFF3E0;color:#BF360C}
.sN1{background:#E3F2FD;color:#0D47A1}
.sN2{background:#EDE7F6;color:#311B92}
.sR{background:#F3E5F5;color:#6A1B9A}
[data-theme=dark] .sD{background:#4E2600;color:#FFCC80}
[data-theme=dark] .sN1{background:#002171;color:#90CAF9}
[data-theme=dark] .sN2{background:#1A0045;color:#CE93D8}
[data-theme=dark] .sR{background:#2D0045;color:#E1BEE7}

/* â”€â”€ Detail panel â”€â”€ */
.panel{position:fixed;bottom:0;left:0;right:0;background:var(--sf);border-top:2px solid var(--ol);padding:14px 16px 30px;transform:translateY(100%);transition:transform .28s cubic-bezier(.4,0,.2,1);z-index:300;box-shadow:0 -4px 24px rgba(0,0,0,.2)}
.panel.open{transform:translateY(0)}
.ph{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
.pd{font-size:17px;font-weight:700}
.cbtn{background:none;border:none;color:var(--tx2);font-size:22px;cursor:pointer;line-height:1}
.cards{display:grid;grid-template-columns:repeat(2,1fr);gap:8px}
.card{background:var(--sh);border-radius:10px;padding:9px 12px}
.card-l{font-size:12px;color:var(--tx2);margin-bottom:4px}
.card-v{font-size:16px;font-weight:700}

/* â”€â”€ Settings modal â”€â”€ */
.ov{position:fixed;inset:0;background:rgba(0,0,0,.5);z-index:400;display:none;align-items:flex-end;justify-content:center}
.ov.open{display:flex}
.modal{background:var(--sf);border-radius:22px 22px 0 0;width:100%;max-width:520px;padding:0 0 36px;animation:su .22s ease;max-height:90vh;overflow-y:auto}
@keyframes su{from{transform:translateY(50px);opacity:0}to{transform:translateY(0);opacity:1}}
.mh{display:flex;justify-content:space-between;align-items:center;padding:16px 20px 12px;border-bottom:1px solid var(--ol);position:sticky;top:0;background:var(--sf);z-index:1}
.mt{font-size:16px;font-weight:700}
.mx{background:none;border:none;font-size:24px;color:var(--tx2);cursor:pointer;line-height:1}
.mb{padding:16px 20px;display:flex;flex-direction:column;gap:16px}
.sec{display:flex;flex-direction:column;gap:8px}
.stl{font-size:11px;font-weight:700;color:var(--tx2);text-transform:uppercase;letter-spacing:.5px}
.row{display:flex;align-items:center;gap:10px}
.rl{font-size:14px;font-weight:600;min-width:48px;flex-shrink:0}
.sel{appearance:none;-webkit-appearance:none;background:var(--sh);border:1.5px solid var(--ol);border-radius:10px;padding:9px 36px 9px 12px;font-size:14px;font-weight:600;color:var(--tx);cursor:pointer;flex:1;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='8'%3E%3Cpath d='M1 1l5 5 5-5' stroke='%23888' stroke-width='2' fill='none' stroke-linecap='round'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 12px center}
.sel:focus{outline:2px solid var(--cs)}
.ggrid{display:grid;grid-template-columns:repeat(5,1fr);gap:7px}
.gbtn{padding:9px 4px;border-radius:10px;border:1.5px solid var(--ol);background:var(--bg);color:var(--tx);font-size:13px;font-weight:700;cursor:pointer;text-align:center;transition:all .15s}
.gbtn.on{border-color:var(--cs);background:var(--cs);color:var(--cst)}
.gbtn:active{opacity:.7}
.cgrid{display:grid;grid-template-columns:1fr 1fr;gap:8px}
.chk{display:flex;align-items:center;gap:8px;padding:10px 12px;border-radius:10px;border:1.5px solid var(--ol);cursor:pointer;user-select:none;transition:all .15s}
.chk.on{border-color:var(--cs);background:var(--ck)}
.cbox{width:18px;height:18px;border-radius:5px;border:2px solid var(--ol);display:flex;align-items:center;justify-content:center;font-size:11px;font-weight:700;color:#fff;flex-shrink:0;transition:all .15s}
.chk.on .cbox{background:var(--cs);border-color:var(--cs)}
.clbl{font-size:13px;font-weight:600}
.apply{background:var(--cs);color:var(--cst);border:none;border-radius:12px;padding:13px;font-size:15px;font-weight:700;cursor:pointer;width:100%}
.apply:active{opacity:.8}

/* â”€â”€ Install banner â”€â”€ */

</style>
</head>
<body>



<header>
  <button class="nav-btn" onclick="navM(-1)">â€¹</button>
  <div class="hdr-mid">
    <button class="icon-btn" onclick="goToday()" title="å›åˆ°ä»Šå¤©">â—</button>
    <span class="month-title" onclick="openModal()">
      <span id="titleText"></span><span class="arr">â–¾</span>
    </span>
    <button class="icon-btn" id="themeBtn" onclick="toggleTheme()">ğŸŒ™</button>
  </div>
  <button class="nav-btn" onclick="navM(1)">â€º</button>
</header>

<div class="bar" id="bar"></div>

<div class="dow-row">
  <div class="dow-cell">ä¸€</div><div class="dow-cell">äºŒ</div>
  <div class="dow-cell">ä¸‰</div><div class="dow-cell">å››</div>
  <div class="dow-cell">äº”</div>
  <div class="dow-cell sat">å…­</div><div class="dow-cell sun">æ—¥</div>
</div>

<div class="cal" id="cal"></div>

<div class="panel" id="panel">
  <div class="ph">
    <span class="pd" id="panelDate"></span>
    <button class="cbtn" onclick="closePanel()">âœ•</button>
  </div>
  <div class="cards" id="panelCards"></div>
</div>

<div class="ov" id="ov" onclick="ovClick(event)">
  <div class="modal">
    <div class="mh">
      <span class="mt">âš™ï¸ è®¾ç½®</span>
      <button class="mx" onclick="closeModal()">âœ•</button>
    </div>
    <div class="mb">
      <div class="sec">
        <div class="stl">ğŸ“… è·³è½¬å¹´æœˆ</div>
        <div class="row"><span class="rl">å¹´ä»½</span><select class="sel" id="selYear"></select></div>
        <div class="row"><span class="rl">æœˆä»½</span>
          <select class="sel" id="selMonth">
            <option value="1">1 æœˆ</option><option value="2">2 æœˆ</option><option value="3">3 æœˆ</option>
            <option value="4">4 æœˆ</option><option value="5">5 æœˆ</option><option value="6">6 æœˆ</option>
            <option value="7">7 æœˆ</option><option value="8">8 æœˆ</option><option value="9">9 æœˆ</option>
            <option value="10">10 æœˆ</option><option value="11">11 æœˆ</option><option value="12">12 æœˆ</option>
          </select>
        </div>
      </div>
      <div class="sec">
        <div class="stl">â­ æˆ‘çš„ç­ç»„ï¼ˆé»˜è®¤æ˜¾ç¤ºï¼‰</div>
        <div class="ggrid" id="groupGrid"></div>
      </div>
      <div class="sec">
        <div class="stl">ğŸ” æ˜¾ç¤ºç­æ¬¡</div>
        <div class="cgrid" id="shiftGrid"></div>
      </div>
      <button class="apply" onclick="applyModal()">âœ“ åº”ç”¨è®¾ç½®</button>
    </div>
  </div>
</div>

<script>
'use strict';
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  å€’ç­å¸¸é‡
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const CYCLE    = [0,1,0,2,3,2,3,1]; // ç™½ä¼‘ç™½ä¸Šä¸‹ä¸Šä¸‹ä¼‘
const SH_NAMES = ['ç™½ç­','ä¼‘æ¯','ä¸Šå¤œ','ä¸‹å¤œ'];
const SH_KEYS  = ['D','R','N1','N2'];
const GROUPS   = ['A','B','C','D'];
const GOFF     = [0,3,7,4];          // ä»¥2026-01-01ä¸ºåŸºå‡†
const BASE     = new Date(2026,0,1);
const today    = new Date();

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  localStorage çŠ¶æ€
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function loadS(){
  // ç‰ˆæœ¬æª¢æŸ¥ï¼šèˆŠç‰ˆæ•¸æ“šå¯èƒ½å°è‡´é¡¯ç¤ºç•°å¸¸ï¼Œå¼·åˆ¶é‡ç½®
  try{
    const v=localStorage.getItem('sc_ver');
    if(v!=='2'){ localStorage.removeItem('sc_s'); localStorage.setItem('sc_ver','2'); return{}; }
    return JSON.parse(localStorage.getItem('sc_s')||'{}');
  }catch{return{};}
}
function saveS(){
  const o={ag:activeGroups,vs:visibleShifts};
  if(defaultGroup!==null) o.dg=defaultGroup;
  localStorage.setItem('sc_s',JSON.stringify(o));
}
const S=loadS();

let cy  = Math.max(2026,Math.min(2050,today.getFullYear()));
let cm2 = today.getMonth()+1;
let selDate = null;

// â˜… defaultGroup: null = æœªè®¾ç½®ï¼ˆæ˜¾ç¤ºå…¨éƒ¨ABCDï¼‰ï¼›0~3 = æŒ‡å®šç­ç»„
let defaultGroup  = S.hasOwnProperty('dg') ? S.dg : null;

// â˜… activeGroups: æœªè®¾ç½®é»˜è®¤ç­ç»„æ—¶ = [0,1,2,3]ï¼›è®¾ç½®å = [defaultGroup]
// è‹¥localStorageæœ‰ä¿å­˜åˆ™ä¼˜å…ˆä½¿ç”¨ï¼Œä½†è¦ä¿è¯é€»è¾‘ä¸€è‡´
// â˜… activeGroupsï¼šç¢ºä¿æ°¸ä¸ç‚ºç©º
// è‹¥ localStorage ç„¡æ•¸æ“šï¼Œæˆ–æœªè¨­é»˜èªç­çµ„ â†’ é¡¯ç¤ºå…¨éƒ¨ [0,1,2,3]
let activeGroups;
if(S.ag && S.ag.length > 0){
  activeGroups = S.ag;
} else {
  activeGroups = (defaultGroup===null) ? [0,1,2,3] : [defaultGroup];
}
// é¡å¤–ä¿åº•ï¼šè‹¥æœ€çµ‚é‚„æ˜¯ç©ºï¼Œå¼·åˆ¶é¡¯ç¤ºå…¨éƒ¨
if(!activeGroups || activeGroups.length === 0) activeGroups = [0,1,2,3];

let visibleShifts = (S.vs && S.vs.length > 0) ? S.vs : [0,1,2,3];
let mDg, mVs; // modal ä¸´æ—¶

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  å†œå†æ•°æ®ä¸ç®—æ³•
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// å„å†œå†å¹´æ­£æœˆåˆä¸€å¯¹åº”çš„å…¬å†æ—¥æœŸï¼ˆæŸ¥è¡¨ï¼Œæœ€å¯é ï¼‰
// æ ¼å¼ï¼š[å¹´, æœˆ, æ—¥] - å…¬å†
const SPRING_BASE = {
  2020:[2020,1,25],2021:[2021,2,12],2022:[2022,2,1],2023:[2023,1,22],
  2024:[2024,2,10],2025:[2025,1,29],2026:[2026,2,17],2027:[2027,2,6],
  2028:[2028,1,26],2029:[2029,2,13],2030:[2030,2,3],2031:[2031,1,23],
  2032:[2032,2,11],2033:[2033,1,31],2034:[2034,2,19],2035:[2035,2,8],
  2036:[2036,1,28],2037:[2037,2,15],2038:[2038,2,4],2039:[2039,1,24],
  2040:[2040,2,12],2041:[2041,2,1],2042:[2042,1,22],2043:[2043,2,10],
  2044:[2044,1,30],2045:[2045,2,17],2046:[2046,2,6],2047:[2047,1,26],
  2048:[2048,2,14],2049:[2049,2,2],2050:[2050,1,23],
};

const LUNAR_INFO = [
  0x04AE53,0x0A5748,0x5526BD,0x0D2650,0x0D9544,0x46AAB9,0x056A4D,0x09AD42,0x24AEB6,0x04AE4A,
  0x6AA4BD,0x0A4D52,0x0D1546,0x0D95BA,0x05492F,0x0A9543,0x2D6AB7,0x056A4B,0x96D4BF,0x04AE53,
  0x0A5748,0x5526BD,0x0D2650,0x0E9244,0x46B2B9,0x056A4D,0x09B142,0x24C4B6,0x04AE4A,0x6AA4BD,
  0x0A4D52,0x0D1546,0x0D95BA,0x05492F,0x0A9543,0x2D6AB7,0x056A4B,0x96D4BF,0x04AE53,0x0A5748,
  0x5526BD,0x0D2650,0x0E9244,0x46B2B9,0x056A4D,0x09B142,0x24C4B6,0x04AE4A,0x6AA4BD,0x0A4D52,
  0x0D1546,0x0D95BA,0x05492F,0x0A9543,0x2D6AB7,0x056A4B,0x96D4BF,0x04AE53,0x0A5748,0x5526BD,
  0x0D2650,0x0E9244,0x46B2B9,0x056A4D,0x09B142,0x24C4B6,0x04AE4A,0x6AA4BD,0x0A4D52,0x0D1546,
  0x0D95BA,0x05492F,0x0A9543,0x2D6AB7,0x056A4B,0x96D4BF,0x04AE53,0x0A5748,0x5526BD,0x0D2650,
  0x0E9244,0x46B2B9,0x056A4D,0x09B142,0x24C4B6,0x04AE4A,0x6AA4BD,0x0A4D52,0x0D1546,0x0D95BA,
  0x05492F,0x0A9543,0x2D6AB7,0x056A4B,0x96D4BF,0x04AE53,0x0A5748,0x5526BD,0x0D2650,0x0E9244,
  0x46B2B9,0x056A4D,0x09B142,0x24C4B6,0x04AE4A,0x6AA4BD,0x0A4D52,0x0D1546,0x0D95BA,0x05492F,
  0x0A9543,0x2D6AB7,0x056A4B,0x96D4BF,0x04AE53,0x0A5748,0x5526BD,0x0D2650,0x0E9244,0x46B2B9,
  0x056A4D,0x09B142,0x24C4B6,0x04AE4A,0x6AA4BD,0x0A4D52,0x0D1546,0x0D95BA,0x05492F,0x0A9543,
  0x2D6AB7,0x056A4B,0x96D4BF,0x04AE53,0x0A5748,0x5526BD,0x0D2650,0x0E9244,0x46B2B9,0x056A4D,
];

function li(y){ return LUNAR_INFO[y-1900]||0; }

// è·å–å†œå†yå¹´å„æœˆå¤©æ•°åºåˆ—ï¼ˆå«é—°æœˆï¼‰
function getMonths(ly){
  const leapM = li(ly)&0xf;
  const months=[];
  for(let m=1;m<=12;m++){
    months.push({m,leap:false,days:(li(ly)&(0x10000>>m))?30:29});
    if(m===leapM) months.push({m,leap:true,days:(li(ly)&0x10000)?30:29});
  }
  return months;
}

// å…¬å†è½¬å†œå†ï¼ˆç”¨äºæ˜¾ç¤ºï¼‰
function solar2lunar(sy,sm,sd){
  // æ‰¾å¯¹åº”å†œå†å¹´ï¼šä»å½“å¹´æˆ–ä¸Šä¸€å¹´æ­£æœˆåˆä¸€å¼€å§‹
  let ly = sy;
  // ç¡®å®šå†œå†å¹´ï¼šæ˜¥èŠ‚åœ¨syå¹´1æœˆå‰åˆ™å†œå†å¹´=sy-1ï¼Œå¦åˆ™=sy
  const sb = SPRING_BASE[ly];
  if(!sb) return null;
  const springDate = new Date(sb[0],sb[1]-1,sb[2]);
  const solar = new Date(sy,sm-1,sd);
  if(solar < springDate){ ly--; }
  const sb2 = SPRING_BASE[ly];
  if(!sb2) return null;
  const base = new Date(sb2[0],sb2[1]-1,sb2[2]);
  let diff = Math.round((solar-base)/86400000);
  if(diff<0) return null;
  const months = getMonths(ly);
  for(const mo of months){
    if(diff < mo.days) return {y:ly,m:mo.m,d:diff+1,leap:mo.leap};
    diff -= mo.days;
  }
  // overflow into next year
  ly++;
  const sb3 = SPRING_BASE[ly];
  if(!sb3) return null;
  return {y:ly,m:1,d:diff+1,leap:false};
}

const CN=['åˆä¸€','åˆäºŒ','åˆä¸‰','åˆå››','åˆäº”','åˆå…­','åˆä¸ƒ','åˆå…«','åˆä¹','åˆå',
  'åä¸€','åäºŒ','åä¸‰','åå››','åäº”','åå…­','åä¸ƒ','åå…«','åä¹','äºŒå',
  'å»¿ä¸€','å»¿äºŒ','å»¿ä¸‰','å»¿å››','å»¿äº”','å»¿å…­','å»¿ä¸ƒ','å»¿å…«','å»¿ä¹','ä¸‰å'];
const CM=['æ­£','äºŒ','ä¸‰','å››','äº”','å…­','ä¸ƒ','å…«','ä¹','å','å†¬','è…Š'];

function lunarStr(sy,sm,sd){
  const l=solar2lunar(sy,sm,sd);
  if(!l) return '';
  if(l.d===1) return (l.leap?'é—°':'')+(CM[l.m-1]||'')+'æœˆ';
  return CN[l.d-1]||'';
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  èŠ‚æ°” 2026-2035ï¼ˆå¤©æ–‡å°ç²¾ç¡®æ•°æ®ï¼‰
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const TERMS_DATA = {
  2026:{'1-5':'å°å¯’','1-20':'å¤§å¯’','2-4':'ç«‹æ˜¥','2-18':'é›¨æ°´','3-6':'æƒŠè›°','3-21':'æ˜¥åˆ†',
        '4-5':'æ¸…æ˜','4-20':'è°·é›¨','5-5':'ç«‹å¤','5-21':'å°æ»¡','6-6':'èŠ’ç§','6-21':'å¤è‡³',
        '7-7':'å°æš‘','7-23':'å¤§æš‘','8-7':'ç«‹ç§‹','8-23':'å¤„æš‘','9-7':'ç™½éœ²','9-22':'ç§‹åˆ†',
        '10-8':'å¯’éœ²','10-23':'éœœé™','11-7':'ç«‹å†¬','11-22':'å°é›ª','12-7':'å¤§é›ª','12-22':'å†¬è‡³'},
  2027:{'1-6':'å°å¯’','1-20':'å¤§å¯’','2-3':'ç«‹æ˜¥','2-18':'é›¨æ°´','3-6':'æƒŠè›°','3-21':'æ˜¥åˆ†',
        '4-5':'æ¸…æ˜','4-20':'è°·é›¨','5-6':'ç«‹å¤','5-21':'å°æ»¡','6-6':'èŠ’ç§','6-21':'å¤è‡³',
        '7-7':'å°æš‘','7-23':'å¤§æš‘','8-7':'ç«‹ç§‹','8-23':'å¤„æš‘','9-8':'ç™½éœ²','9-23':'ç§‹åˆ†',
        '10-8':'å¯’éœ²','10-23':'éœœé™','11-7':'ç«‹å†¬','11-22':'å°é›ª','12-7':'å¤§é›ª','12-22':'å†¬è‡³'},
  2028:{'1-6':'å°å¯’','1-21':'å¤§å¯’','2-4':'ç«‹æ˜¥','2-19':'é›¨æ°´','3-5':'æƒŠè›°','3-20':'æ˜¥åˆ†',
        '4-4':'æ¸…æ˜','4-19':'è°·é›¨','5-5':'ç«‹å¤','5-20':'å°æ»¡','6-5':'èŠ’ç§','6-21':'å¤è‡³',
        '7-6':'å°æš‘','7-22':'å¤§æš‘','8-7':'ç«‹ç§‹','8-22':'å¤„æš‘','9-7':'ç™½éœ²','9-22':'ç§‹åˆ†',
        '10-7':'å¯’éœ²','10-22':'éœœé™','11-7':'ç«‹å†¬','11-21':'å°é›ª','12-6':'å¤§é›ª','12-21':'å†¬è‡³'},
  2029:{'1-5':'å°å¯’','1-20':'å¤§å¯’','2-3':'ç«‹æ˜¥','2-18':'é›¨æ°´','3-5':'æƒŠè›°','3-20':'æ˜¥åˆ†',
        '4-4':'æ¸…æ˜','4-20':'è°·é›¨','5-5':'ç«‹å¤','5-21':'å°æ»¡','6-5':'èŠ’ç§','6-21':'å¤è‡³',
        '7-7':'å°æš‘','7-22':'å¤§æš‘','8-7':'ç«‹ç§‹','8-23':'å¤„æš‘','9-7':'ç™½éœ²','9-22':'ç§‹åˆ†',
        '10-8':'å¯’éœ²','10-23':'éœœé™','11-7':'ç«‹å†¬','11-22':'å°é›ª','12-7':'å¤§é›ª','12-21':'å†¬è‡³'},
  2030:{'1-5':'å°å¯’','1-20':'å¤§å¯’','2-4':'ç«‹æ˜¥','2-19':'é›¨æ°´','3-6':'æƒŠè›°','3-21':'æ˜¥åˆ†',
        '4-5':'æ¸…æ˜','4-20':'è°·é›¨','5-6':'ç«‹å¤','5-21':'å°æ»¡','6-6':'èŠ’ç§','6-21':'å¤è‡³',
        '7-7':'å°æš‘','7-23':'å¤§æš‘','8-7':'ç«‹ç§‹','8-23':'å¤„æš‘','9-8':'ç™½éœ²','9-23':'ç§‹åˆ†',
        '10-8':'å¯’éœ²','10-23':'éœœé™','11-7':'ç«‹å†¬','11-22':'å°é›ª','12-7':'å¤§é›ª','12-22':'å†¬è‡³'},
  2031:{'1-6':'å°å¯’','1-20':'å¤§å¯’','2-4':'ç«‹æ˜¥','2-19':'é›¨æ°´','3-6':'æƒŠè›°','3-21':'æ˜¥åˆ†',
        '4-5':'æ¸…æ˜','4-21':'è°·é›¨','5-6':'ç«‹å¤','5-21':'å°æ»¡','6-6':'èŠ’ç§','6-22':'å¤è‡³',
        '7-7':'å°æš‘','7-23':'å¤§æš‘','8-8':'ç«‹ç§‹','8-23':'å¤„æš‘','9-8':'ç™½éœ²','9-23':'ç§‹åˆ†',
        '10-8':'å¯’éœ²','10-24':'éœœé™','11-8':'ç«‹å†¬','11-22':'å°é›ª','12-7':'å¤§é›ª','12-22':'å†¬è‡³'},
  2032:{'1-6':'å°å¯’','1-21':'å¤§å¯’','2-5':'ç«‹æ˜¥','2-19':'é›¨æ°´','3-5':'æƒŠè›°','3-20':'æ˜¥åˆ†',
        '4-4':'æ¸…æ˜','4-19':'è°·é›¨','5-5':'ç«‹å¤','5-20':'å°æ»¡','6-5':'èŠ’ç§','6-21':'å¤è‡³',
        '7-6':'å°æš‘','7-22':'å¤§æš‘','8-7':'ç«‹ç§‹','8-22':'å¤„æš‘','9-7':'ç™½éœ²','9-22':'ç§‹åˆ†',
        '10-7':'å¯’éœ²','10-23':'éœœé™','11-7':'ç«‹å†¬','11-21':'å°é›ª','12-6':'å¤§é›ª','12-21':'å†¬è‡³'},
  2033:{'1-5':'å°å¯’','1-20':'å¤§å¯’','2-3':'ç«‹æ˜¥','2-18':'é›¨æ°´','3-5':'æƒŠè›°','3-20':'æ˜¥åˆ†',
        '4-5':'æ¸…æ˜','4-20':'è°·é›¨','5-5':'ç«‹å¤','5-21':'å°æ»¡','6-5':'èŠ’ç§','6-21':'å¤è‡³',
        '7-7':'å°æš‘','7-22':'å¤§æš‘','8-7':'ç«‹ç§‹','8-23':'å¤„æš‘','9-7':'ç™½éœ²','9-23':'ç§‹åˆ†',
        '10-8':'å¯’éœ²','10-23':'éœœé™','11-7':'ç«‹å†¬','11-22':'å°é›ª','12-7':'å¤§é›ª','12-22':'å†¬è‡³'},
  2034:{'1-5':'å°å¯’','1-20':'å¤§å¯’','2-4':'ç«‹æ˜¥','2-19':'é›¨æ°´','3-6':'æƒŠè›°','3-21':'æ˜¥åˆ†',
        '4-5':'æ¸…æ˜','4-20':'è°·é›¨','5-5':'ç«‹å¤','5-21':'å°æ»¡','6-6':'èŠ’ç§','6-21':'å¤è‡³',
        '7-7':'å°æš‘','7-23':'å¤§æš‘','8-7':'ç«‹ç§‹','8-23':'å¤„æš‘','9-8':'ç™½éœ²','9-23':'ç§‹åˆ†',
        '10-8':'å¯’éœ²','10-23':'éœœé™','11-7':'ç«‹å†¬','11-22':'å°é›ª','12-7':'å¤§é›ª','12-22':'å†¬è‡³'},
  2035:{'1-6':'å°å¯’','1-20':'å¤§å¯’','2-4':'ç«‹æ˜¥','2-18':'é›¨æ°´','3-6':'æƒŠè›°','3-21':'æ˜¥åˆ†',
        '4-5':'æ¸…æ˜','4-20':'è°·é›¨','5-6':'ç«‹å¤','5-21':'å°æ»¡','6-6':'èŠ’ç§','6-21':'å¤è‡³',
        '7-7':'å°æš‘','7-23':'å¤§æš‘','8-8':'ç«‹ç§‹','8-23':'å¤„æš‘','9-8':'ç™½éœ²','9-23':'ç§‹åˆ†',
        '10-8':'å¯’éœ²','10-23':'éœœé™','11-8':'ç«‹å†¬','11-22':'å°é›ª','12-7':'å¤§é›ª','12-22':'å†¬è‡³'},
};
function getTerm(y,m,d){ const t=TERMS_DATA[y]; return t?(t[`${m}-${d}`]||''):''; }

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  ä¸­å›½å¤§é™†æ³•å®šèŠ‚å‡æ—¥ï¼ˆ2026-2035ï¼‰
//  ç²¾ç¡®æ—¥æœŸç”±å¤©æ–‡å°å†œå†æ•°æ®è®¡ç®—
//  value: èŠ‚æ—¥åç§°ï¼›WORKDAY set: è°ƒä¼‘è¡¥ç­æ—¥
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const HOL = {
  // â”€â”€ 2026 â”€â”€
  // å…ƒæ—¦
  '2026-1-1':'å…ƒæ—¦',
  // æ˜¥èŠ‚ï¼šé™¤å¤•2.16ï¼Œåˆä¸€~åˆä¸ƒ 2.17-2.23
  '2026-2-16':'é™¤å¤•','2026-2-17':'æ˜¥èŠ‚','2026-2-18':'æ˜¥èŠ‚','2026-2-19':'æ˜¥èŠ‚',
  '2026-2-20':'æ˜¥èŠ‚','2026-2-21':'æ˜¥èŠ‚','2026-2-22':'æ˜¥èŠ‚','2026-2-23':'æ˜¥èŠ‚',
  // æ¸…æ˜èŠ‚
  '2026-4-5':'æ¸…æ˜èŠ‚',
  // åŠ³åŠ¨èŠ‚
  '2026-5-1':'åŠ³åŠ¨èŠ‚','2026-5-2':'åŠ³åŠ¨èŠ‚','2026-5-3':'åŠ³åŠ¨èŠ‚',
  // ç«¯åˆèŠ‚ï¼šå†œå†äº”æœˆåˆäº” = 2026-06-20 (æ³¨æ„2026å¹´å†œå†äº”æœˆåˆäº”å‡†ç¡®æ—¥æœŸ)
  // å†œå†2026å¹´ï¼ˆä¸™åˆå¹´ï¼‰æ­£æœˆåˆä¸€=2026-02-17ï¼Œäº”æœˆåˆäº”éœ€æ¨ç®—
  // 2026å¹´é—°å…­æœˆï¼Œäº”æœˆ=31å¤©ï¼Œæ­£æœˆ29+äºŒæœˆ30+ä¸‰æœˆ29+å››æœˆ30=118å¤©ï¼Œåˆ°äº”æœˆåˆäº”+4=122å¤©
  // 2026-02-17 + 122 = 2026-06-19
  '2026-6-19':'ç«¯åˆèŠ‚',
  // å›½åº†+ä¸­ç§‹ï¼ˆä¸­ç§‹ï¼šå†œå†å…«æœˆåäº”=2026-10-24ï¼Œå›½åº†åä¸€è¿ä¼‘ï¼‰
  '2026-10-1':'å›½åº†èŠ‚','2026-10-2':'å›½åº†èŠ‚','2026-10-3':'å›½åº†èŠ‚',
  '2026-10-4':'å›½åº†èŠ‚','2026-10-5':'å›½åº†èŠ‚','2026-10-6':'å›½åº†èŠ‚','2026-10-7':'å›½åº†èŠ‚',
  '2026-10-24':'ä¸­ç§‹èŠ‚',

  // â”€â”€ 2027 â”€â”€
  '2027-1-1':'å…ƒæ—¦',
  // æ˜¥èŠ‚ï¼šé™¤å¤•2.5ï¼Œåˆä¸€~åˆä¸ƒ 2.6-2.12
  '2027-2-5':'é™¤å¤•','2027-2-6':'æ˜¥èŠ‚','2027-2-7':'æ˜¥èŠ‚','2027-2-8':'æ˜¥èŠ‚',
  '2027-2-9':'æ˜¥èŠ‚','2027-2-10':'æ˜¥èŠ‚','2027-2-11':'æ˜¥èŠ‚','2027-2-12':'æ˜¥èŠ‚',
  '2027-4-5':'æ¸…æ˜èŠ‚',
  '2027-5-1':'åŠ³åŠ¨èŠ‚','2027-5-2':'åŠ³åŠ¨èŠ‚','2027-5-3':'åŠ³åŠ¨èŠ‚',
  // ç«¯åˆï¼šå†œå†2027å¹´äº”æœˆåˆäº”=2027-06-09ï¼ˆä¸æœªå¹´æ­£æœˆåˆä¸€2027-02-06ï¼Œæ¨ç®—ï¼‰
  '2027-6-9':'ç«¯åˆèŠ‚',
  // ä¸­ç§‹ï¼šå†œå†2027å¹´å…«æœˆåäº”=2027-09-14 ï¼ˆæ¨ç®—ï¼‰
  '2027-9-14':'ä¸­ç§‹èŠ‚',
  '2027-10-1':'å›½åº†èŠ‚','2027-10-2':'å›½åº†èŠ‚','2027-10-3':'å›½åº†èŠ‚',
  '2027-10-4':'å›½åº†èŠ‚','2027-10-5':'å›½åº†èŠ‚','2027-10-6':'å›½åº†èŠ‚','2027-10-7':'å›½åº†èŠ‚',

  // â”€â”€ 2028 â”€â”€
  // å…ƒæ—¦ï¼š2027-12-31è°ƒä¼‘+2028-01-01
  '2028-1-1':'å…ƒæ—¦',
  // æ˜¥èŠ‚ï¼šé™¤å¤•1.25ï¼Œåˆä¸€~åˆä¸ƒ 1.26-2.1
  '2028-1-25':'é™¤å¤•','2028-1-26':'æ˜¥èŠ‚','2028-1-27':'æ˜¥èŠ‚','2028-1-28':'æ˜¥èŠ‚',
  '2028-1-29':'æ˜¥èŠ‚','2028-1-30':'æ˜¥èŠ‚','2028-1-31':'æ˜¥èŠ‚','2028-2-1':'æ˜¥èŠ‚',
  '2028-4-4':'æ¸…æ˜èŠ‚',
  '2028-5-1':'åŠ³åŠ¨èŠ‚','2028-5-2':'åŠ³åŠ¨èŠ‚','2028-5-3':'åŠ³åŠ¨èŠ‚',
  // ç«¯åˆï¼šå†œå†2028å¹´äº”æœˆåˆäº”=2028-06-01ï¼ˆæˆŠç”³å¹´æ­£æœˆåˆä¸€2028-01-26ï¼Œæ¨ç®—ï¼‰
  // æ­£æœˆ29+äºŒæœˆ30+ä¸‰æœˆ29+å››æœˆ29=117ï¼Œäº”æœˆåˆ5=121å¤©ï¼Œ2028-01-26+121=2028-05-26
  '2028-5-26':'ç«¯åˆèŠ‚',
  // ä¸­ç§‹ï¼šå†œå†2028å¹´å…«æœˆåäº”=2028-10-03ï¼ˆæ¨ç®—ï¼‰
  '2028-10-3':'ä¸­ç§‹èŠ‚',
  '2028-10-1':'å›½åº†èŠ‚','2028-10-2':'å›½åº†èŠ‚',
  '2028-10-4':'å›½åº†èŠ‚','2028-10-5':'å›½åº†èŠ‚','2028-10-6':'å›½åº†èŠ‚','2028-10-7':'å›½åº†èŠ‚',

  // â”€â”€ 2029 â”€â”€
  '2029-1-1':'å…ƒæ—¦',
  // æ˜¥èŠ‚ï¼šé™¤å¤•2.12ï¼Œåˆä¸€~åˆä¸ƒ 2.13-2.19
  '2029-2-12':'é™¤å¤•','2029-2-13':'æ˜¥èŠ‚','2029-2-14':'æ˜¥èŠ‚','2029-2-15':'æ˜¥èŠ‚',
  '2029-2-16':'æ˜¥èŠ‚','2029-2-17':'æ˜¥èŠ‚','2029-2-18':'æ˜¥èŠ‚','2029-2-19':'æ˜¥èŠ‚',
  '2029-4-4':'æ¸…æ˜èŠ‚',
  '2029-5-1':'åŠ³åŠ¨èŠ‚','2029-5-2':'åŠ³åŠ¨èŠ‚','2029-5-3':'åŠ³åŠ¨èŠ‚',
  // ç«¯åˆï¼šå†œå†2029å¹´äº”æœˆåˆäº”=2029-06-01ï¼ˆå·±é…‰å¹´æ­£æœˆåˆä¸€2029-02-13ï¼‰
  // 2029å¹´æœ‰é—°å…­æœˆï¼Œæ­£æœˆ30+äºŒæœˆ29+ä¸‰æœˆ30+å››æœˆ29=118ï¼Œäº”æœˆåˆäº”=122å¤©
  // 2029-02-13+122=2029-06-15
  '2029-6-15':'ç«¯åˆèŠ‚',
  // ä¸­ç§‹ï¼šå†œå†2029å¹´å…«æœˆåäº”=2029-10-07ï¼ˆæ¨ç®—ï¼‰
  '2029-10-7':'ä¸­ç§‹èŠ‚',
  '2029-10-1':'å›½åº†èŠ‚','2029-10-2':'å›½åº†èŠ‚','2029-10-3':'å›½åº†èŠ‚',
  '2029-10-4':'å›½åº†èŠ‚','2029-10-5':'å›½åº†èŠ‚','2029-10-6':'å›½åº†èŠ‚',

  // â”€â”€ 2030 â”€â”€
  '2030-1-1':'å…ƒæ—¦',
  // æ˜¥èŠ‚ï¼šé™¤å¤•2.2ï¼Œåˆä¸€~åˆä¸ƒ 2.3-2.9
  '2030-2-2':'é™¤å¤•','2030-2-3':'æ˜¥èŠ‚','2030-2-4':'æ˜¥èŠ‚','2030-2-5':'æ˜¥èŠ‚',
  '2030-2-6':'æ˜¥èŠ‚','2030-2-7':'æ˜¥èŠ‚','2030-2-8':'æ˜¥èŠ‚','2030-2-9':'æ˜¥èŠ‚',
  '2030-4-5':'æ¸…æ˜èŠ‚',
  '2030-5-1':'åŠ³åŠ¨èŠ‚','2030-5-2':'åŠ³åŠ¨èŠ‚','2030-5-3':'åŠ³åŠ¨èŠ‚',
  // ç«¯åˆï¼šå†œå†2030å¹´äº”æœˆåˆäº”=2030-06-22ï¼ˆåºšæˆŒå¹´æ­£æœˆåˆä¸€2030-02-03ï¼‰
  // æ­£æœˆ29+äºŒæœˆ30+ä¸‰æœˆ29+å››æœˆ30=118ï¼Œäº”æœˆåˆäº”=122å¤©
  // 2030-02-03+122=2030-06-05
  '2030-6-5':'ç«¯åˆèŠ‚',
  // ä¸­ç§‹ï¼šå†œå†2030å¹´å…«æœˆåäº”=2030-09-22ï¼ˆæ¨ç®—ï¼Œ2030å¹´ä¸­ç§‹å’Œå›½åº†ç›¸è¿‘ï¼‰
  '2030-9-22':'ä¸­ç§‹èŠ‚',
  '2030-10-1':'å›½åº†èŠ‚','2030-10-2':'å›½åº†èŠ‚','2030-10-3':'å›½åº†èŠ‚',
  '2030-10-4':'å›½åº†èŠ‚','2030-10-5':'å›½åº†èŠ‚','2030-10-6':'å›½åº†èŠ‚','2030-10-7':'å›½åº†èŠ‚',

  // â”€â”€ 2031-2035 å…ƒæ—¦ã€å›½åº†ï¼ˆæ˜¥èŠ‚ç­‰åç»­è¡¥å……ï¼‰â”€â”€
  '2031-1-1':'å…ƒæ—¦',
  '2031-1-23':'æ˜¥èŠ‚','2031-1-24':'æ˜¥èŠ‚','2031-1-25':'æ˜¥èŠ‚',
  '2031-1-26':'æ˜¥èŠ‚','2031-1-27':'æ˜¥èŠ‚','2031-1-28':'æ˜¥èŠ‚','2031-1-29':'æ˜¥èŠ‚',
  '2031-1-22':'é™¤å¤•',
  '2031-4-5':'æ¸…æ˜èŠ‚',
  '2031-5-1':'åŠ³åŠ¨èŠ‚','2031-5-2':'åŠ³åŠ¨èŠ‚','2031-5-3':'åŠ³åŠ¨èŠ‚',
  '2031-5-25':'ç«¯åˆèŠ‚',
  '2031-9-10':'ä¸­ç§‹èŠ‚',
  '2031-10-1':'å›½åº†èŠ‚','2031-10-2':'å›½åº†èŠ‚','2031-10-3':'å›½åº†èŠ‚',
  '2031-10-4':'å›½åº†èŠ‚','2031-10-5':'å›½åº†èŠ‚','2031-10-6':'å›½åº†èŠ‚','2031-10-7':'å›½åº†èŠ‚',

  '2032-1-1':'å…ƒæ—¦',
  '2032-2-10':'é™¤å¤•','2032-2-11':'æ˜¥èŠ‚','2032-2-12':'æ˜¥èŠ‚','2032-2-13':'æ˜¥èŠ‚',
  '2032-2-14':'æ˜¥èŠ‚','2032-2-15':'æ˜¥èŠ‚','2032-2-16':'æ˜¥èŠ‚','2032-2-17':'æ˜¥èŠ‚',
  '2032-4-4':'æ¸…æ˜èŠ‚',
  '2032-5-1':'åŠ³åŠ¨èŠ‚','2032-5-2':'åŠ³åŠ¨èŠ‚','2032-5-3':'åŠ³åŠ¨èŠ‚',
  '2032-6-12':'ç«¯åˆèŠ‚',
  '2032-9-29':'ä¸­ç§‹èŠ‚',
  '2032-10-1':'å›½åº†èŠ‚','2032-10-2':'å›½åº†èŠ‚','2032-10-3':'å›½åº†èŠ‚',
  '2032-10-4':'å›½åº†èŠ‚','2032-10-5':'å›½åº†èŠ‚','2032-10-6':'å›½åº†èŠ‚','2032-10-7':'å›½åº†èŠ‚',

  '2033-1-1':'å…ƒæ—¦',
  '2033-1-30':'é™¤å¤•','2033-1-31':'æ˜¥èŠ‚','2033-2-1':'æ˜¥èŠ‚','2033-2-2':'æ˜¥èŠ‚',
  '2033-2-3':'æ˜¥èŠ‚','2033-2-4':'æ˜¥èŠ‚','2033-2-5':'æ˜¥èŠ‚','2033-2-6':'æ˜¥èŠ‚',
  '2033-4-5':'æ¸…æ˜èŠ‚',
  '2033-5-1':'åŠ³åŠ¨èŠ‚','2033-5-2':'åŠ³åŠ¨èŠ‚','2033-5-3':'åŠ³åŠ¨èŠ‚',
  '2033-6-20':'ç«¯åˆèŠ‚',
  '2033-9-28':'ä¸­ç§‹èŠ‚',
  '2033-10-1':'å›½åº†èŠ‚','2033-10-2':'å›½åº†èŠ‚','2033-10-3':'å›½åº†èŠ‚',
  '2033-10-4':'å›½åº†èŠ‚','2033-10-5':'å›½åº†èŠ‚','2033-10-6':'å›½åº†èŠ‚','2033-10-7':'å›½åº†èŠ‚',

  '2034-1-1':'å…ƒæ—¦',
  '2034-2-18':'é™¤å¤•','2034-2-19':'æ˜¥èŠ‚','2034-2-20':'æ˜¥èŠ‚','2034-2-21':'æ˜¥èŠ‚',
  '2034-2-22':'æ˜¥èŠ‚','2034-2-23':'æ˜¥èŠ‚','2034-2-24':'æ˜¥èŠ‚','2034-2-25':'æ˜¥èŠ‚',
  '2034-4-5':'æ¸…æ˜èŠ‚',
  '2034-5-1':'åŠ³åŠ¨èŠ‚','2034-5-2':'åŠ³åŠ¨èŠ‚','2034-5-3':'åŠ³åŠ¨èŠ‚',
  '2034-6-9':'ç«¯åˆèŠ‚',
  '2034-9-17':'ä¸­ç§‹èŠ‚',
  '2034-10-1':'å›½åº†èŠ‚','2034-10-2':'å›½åº†èŠ‚','2034-10-3':'å›½åº†èŠ‚',
  '2034-10-4':'å›½åº†èŠ‚','2034-10-5':'å›½åº†èŠ‚','2034-10-6':'å›½åº†èŠ‚','2034-10-7':'å›½åº†èŠ‚',

  '2035-1-1':'å…ƒæ—¦',
  '2035-2-7':'é™¤å¤•','2035-2-8':'æ˜¥èŠ‚','2035-2-9':'æ˜¥èŠ‚','2035-2-10':'æ˜¥èŠ‚',
  '2035-2-11':'æ˜¥èŠ‚','2035-2-12':'æ˜¥èŠ‚','2035-2-13':'æ˜¥èŠ‚','2035-2-14':'æ˜¥èŠ‚',
  '2035-4-5':'æ¸…æ˜èŠ‚',
  '2035-5-1':'åŠ³åŠ¨èŠ‚','2035-5-2':'åŠ³åŠ¨èŠ‚','2035-5-3':'åŠ³åŠ¨èŠ‚',
  '2035-6-28':'ç«¯åˆèŠ‚',
  '2035-9-7':'ä¸­ç§‹èŠ‚',
  '2035-10-1':'å›½åº†èŠ‚','2035-10-2':'å›½åº†èŠ‚','2035-10-3':'å›½åº†èŠ‚',
  '2035-10-4':'å›½åº†èŠ‚','2035-10-5':'å›½åº†èŠ‚','2035-10-6':'å›½åº†èŠ‚','2035-10-7':'å›½åº†èŠ‚',
};

// è°ƒä¼‘è¡¥ç­ï¼ˆä¸Šç­æ—¥ï¼Œå³ä¾¿æ˜¯å‘¨æœ«ä¹Ÿæ­£å¸¸ä¸Šç­ï¼‰
const WORKDAY = new Set([
  // 2026
  '2026-2-8','2026-2-15','2026-4-26','2026-5-4','2026-10-11',
  // 2027
  '2027-1-31','2027-2-28','2027-4-25','2027-5-9','2027-10-10',
  // 2028
  '2028-1-21','2028-2-6','2028-4-30','2028-10-8',
  // 2029
  '2029-2-4','2029-2-23','2029-4-27','2029-9-29',
  // 2030
  '2030-1-27','2030-2-10','2030-4-27','2030-9-29','2030-10-12',
]);

function dk(y,m,d){ return `${y}-${m}-${d}`; }
function getHol(y,m,d){ return HOL[dk(y,m,d)]||''; }
function isWork(y,m,d){ return WORKDAY.has(dk(y,m,d)); }

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  ç­æ¬¡è®¡ç®—
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function getShift(gi,date){
  const diff=Math.round((date-BASE)/86400000);
  return CYCLE[(((diff+GOFF[gi])%8)+8)%8];
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  ä¸»é¢˜
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function toggleTheme(){
  const dark=document.documentElement.getAttribute('data-theme')==='dark';
  document.documentElement.setAttribute('data-theme',dark?'':'dark');
  document.getElementById('themeBtn').textContent=dark?'ğŸŒ™':'â˜€ï¸';
  localStorage.setItem('sc_th',dark?'l':'d');
}
if(localStorage.getItem('sc_th')==='d'){
  document.documentElement.setAttribute('data-theme','dark');
  document.getElementById('themeBtn').textContent='â˜€ï¸';
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  Chip æ æ¸²æŸ“
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderBar(){
  const bar=document.getElementById('bar');
  bar.innerHTML='';
  GROUPS.forEach((g,i)=>{
    const c=document.createElement('div');
    c.className='chip'+(activeGroups.includes(i)?' on':'');
    c.textContent=g+'ç­';
    c.onclick=()=>{
      if(activeGroups.includes(i)) activeGroups=activeGroups.filter(x=>x!==i);
      else activeGroups.push(i);
      saveS(); renderBar(); render();
    };
    bar.appendChild(c);
  });
  const sep=document.createElement('div');sep.className='bsep';bar.appendChild(sep);
  const btn=document.createElement('button');btn.className='set-btn';btn.textContent='âš™ï¸ è®¾ç½®';
  btn.onclick=openModal;bar.appendChild(btn);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  æ—¥å†æ¸²æŸ“ï¼ˆå‘¨ä¸€å¼€å§‹ï¼‰
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function render(){
  document.getElementById('titleText').textContent=`${cy}å¹´ ${cm2}æœˆ`;
  const cal=document.getElementById('cal');
  cal.innerHTML='';
  const first=new Date(cy,cm2-1,1);
  // å‘¨ä¸€=0, å‘¨æ—¥=6  (getDay: 0=æ—¥â†’6, 1=ä¸€â†’0, ..., 6=å…­â†’5)
  const startCol=(first.getDay()+6)%7;
  const dim=new Date(cy,cm2,0).getDate();
  const prevDim=new Date(cy,cm2-1,0).getDate();

  // ä¸Šæœˆè¡¥ä½
  for(let i=startCol-1;i>=0;i--){
    const d=document.createElement('div');d.className='day other';
    d.innerHTML=`<div class="dn">${prevDim-i}</div>`;cal.appendChild(d);
  }

  // æœ¬æœˆ
  for(let d=1;d<=dim;d++){
    const date=new Date(cy,cm2-1,d);
    const dow=date.getDay(); // 0=æ—¥,6=å…­
    const isToday=cy===today.getFullYear()&&cm2===today.getMonth()+1&&d===today.getDate();
    const isSel=selDate&&selDate.getTime()===date.getTime();
    const hol=getHol(cy,cm2,d);
    const work=isWork(cy,cm2,d);
    const term=getTerm(cy,cm2,d);
    const lstr=lunarStr(cy,cm2,d);

    let cls='day';
    if(work) cls+=' work-day'; // è°ƒä¼‘ä¸Šç­ï¼Œä¸ç€è‰²
    else if(dow===6) cls+=' sat';
    else if(dow===0) cls+=' sun';
    if(isToday) cls+=' today';
    if(isSel) cls+=' selected';

    // ç­æ¬¡æ ‡ç­¾
    let stHtml='';
    if(activeGroups.length>0){
      activeGroups.forEach(gi=>{
        const s=getShift(gi,date);
        if(visibleShifts.includes(s)){
          stHtml+=`<div class="st s${SH_KEYS[s]}">${GROUPS[gi]}${SH_NAMES[s]}</div>`;
        }
      });
    }

    const div=document.createElement('div');div.className=cls;
    let html='';
    if(hol) html+=`<div class="hol-dot" title="${hol}"></div>`;
    html+=`<div class="dn">${d}${work?'<span class="work-lbl"> ç­</span>':''}</div>`;
    if(term) html+=`<div class="lun"><span class="term-lbl">${term}</span></div>`;
    else if(hol&&lstr) html+=`<div class="lun"><span class="hol-name">${hol}</span></div>`;
    else html+=`<div class="lun">${lstr}</div>`;

    if(stHtml) html+=`<div class="stags">${stHtml}</div>`;
    div.innerHTML=html;
    div.onclick=()=>showPanel(date,d,lstr,term,hol,work);
    cal.appendChild(div);
  }

  // ä¸‹æœˆè¡¥ä½
  const total=startCol+dim;
  const rem=(7-total%7)%7;
  for(let i=1;i<=rem;i++){
    const d=document.createElement('div');d.className='day other';
    d.innerHTML=`<div class="dn">${i}</div>`;cal.appendChild(d);
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  æ—¥æœŸè¯¦æƒ…é¢æ¿
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const DOW_CN=['å‘¨æ—¥','å‘¨ä¸€','å‘¨äºŒ','å‘¨ä¸‰','å‘¨å››','å‘¨äº”','å‘¨å…­'];
function showPanel(date,d,lstr,term,hol,work){
  selDate=date; render();
  document.getElementById('panelDate').textContent=
    `${date.getFullYear()}å¹´${date.getMonth()+1}æœˆ${d}æ—¥ ${DOW_CN[date.getDay()]}${work?' [è°ƒä¼‘ä¸Šç­]':''}`;
  const cards=document.getElementById('panelCards'); cards.innerHTML='';
  const rows=[
    ['å†œå†', lstr||'â€”'],
    ['èŠ‚æ°”', term||'â€”'],
    ['èŠ‚å‡æ—¥', hol||(work?'è°ƒä¼‘ä¸Šç­':'â€”')],
  ];
  activeGroups.forEach(gi=>{
    const s=getShift(gi,date);
    rows.push([`${GROUPS[gi]}ç­`, SH_NAMES[s]]);
  });
  rows.forEach(([l,v])=>{
    const c=document.createElement('div');c.className='card';
    c.innerHTML=`<div class="card-l">${l}</div><div class="card-v">${v}</div>`;
    cards.appendChild(c);
  });
  document.getElementById('panel').classList.add('open');
}
function closePanel(){
  document.getElementById('panel').classList.remove('open');
  selDate=null; render();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  å¯¼èˆª
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function navM(delta){
  cm2+=delta;
  if(cm2>12){cm2=1;cy++;}
  if(cm2<1){cm2=12;cy--;}
  cy=Math.max(2026,Math.min(2050,cy));
  render();
}
function goToday(){
  cy=Math.max(2026,Math.min(2050,today.getFullYear()));
  cm2=today.getMonth()+1;
  render();
  const d=today.getDate();
  showPanel(today,d,lunarStr(cy,cm2,d),getTerm(cy,cm2,d),getHol(cy,cm2,d),isWork(cy,cm2,d));
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  è®¾ç½®å¼¹çª—
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function openModal(){
  // å¹´ä»½
  const sy=document.getElementById('selYear'); sy.innerHTML='';
  for(let y=2026;y<=2050;y++){
    const o=document.createElement('option');o.value=y;o.textContent=y+'å¹´';
    if(y===cy)o.selected=true; sy.appendChild(o);
  }
  document.getElementById('selMonth').value=cm2;
  mDg=defaultGroup;
  buildGroupBtns();
  mVs=[...visibleShifts];
  buildShiftChks();
  document.getElementById('ov').classList.add('open');
}

function buildGroupBtns(){
  const g=document.getElementById('groupGrid'); g.innerHTML='';
  // ç¬¬ä¸€ä¸ªæŒ‰é’®ï¼šå…¨éƒ¨
  const all=document.createElement('button');
  all.className='gbtn'+(mDg===null?' on':'');
  all.textContent='å…¨éƒ¨';
  all.onclick=()=>{mDg=null;buildGroupBtns();};
  g.appendChild(all);
  GROUPS.forEach((name,i)=>{
    const btn=document.createElement('button');
    btn.className='gbtn'+(mDg===i?' on':'');
    btn.textContent=name+'ç­';
    btn.onclick=()=>{mDg=i;buildGroupBtns();};
    g.appendChild(btn);
  });
}

function buildShiftChks(){
  const g=document.getElementById('shiftGrid'); g.innerHTML='';
  SH_NAMES.forEach((name,i)=>{
    const item=document.createElement('div');
    item.className='chk'+(mVs.includes(i)?' on':'');
    item.innerHTML=`<div class="cbox">${mVs.includes(i)?'âœ“':''}</div><span class="clbl">${name}</span>`;
    item.onclick=()=>{
      if(mVs.includes(i)) mVs=mVs.filter(x=>x!==i); else mVs.push(i);
      const on=mVs.includes(i);
      item.classList.toggle('on',on);
      item.querySelector('.cbox').textContent=on?'âœ“':'';
    };
    g.appendChild(item);
  });
}

function closeModal(){ document.getElementById('ov').classList.remove('open'); }
function ovClick(e){ if(e.target===document.getElementById('ov'))closeModal(); }

function applyModal(){
  cy=parseInt(document.getElementById('selYear').value);
  cm2=parseInt(document.getElementById('selMonth').value);
  defaultGroup=mDg;
  // â˜… æ ¸å¿ƒé€»è¾‘ï¼šæœªè®¾ç½®(null)=å…¨éƒ¨ï¼›è®¾ç½®å=åªæ¿€æ´»è¯¥ç­ç»„
  if(defaultGroup===null) activeGroups=[0,1,2,3];
  else activeGroups=[defaultGroup];
  if(mVs.length>0) visibleShifts=[...mVs];
  saveS(); renderBar(); render(); closeModal();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  è§¦æ‘¸æ»‘åŠ¨åˆ‡æœˆ
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let tx=0;
document.getElementById('cal').addEventListener('touchstart',e=>{tx=e.touches[0].clientX;},{passive:true});
document.getElementById('cal').addEventListener('touchend',e=>{
  const dx=e.changedTouches[0].clientX-tx;
  if(Math.abs(dx)>50) navM(dx<0?1:-1);
},{passive:true});
document.addEventListener('click',e=>{
  const p=document.getElementById('panel');
  if(p.classList.contains('open')&&!p.contains(e.target)&&!e.target.closest('.day')) closePanel();
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  PWA
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// PWAï¼šæ³¨å†ŠçœŸæ­£çš„ Service Worker
if('serviceWorker' in navigator){
  navigator.serviceWorker.register('./sw.js').catch(e=>console.log('SW:',e));
}
// Manifest inline
const mf={name:'å€’ç­ä¸‡å¹´å†',short_name:'å€’ç­å†',start_url:'./',scope:'./',display:'standalone',background_color:'#FEFBFF',theme_color:'#6750A4',icons:[{src:"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 192 192'%3E%3Crect width='192' height='192' rx='32' fill='%236750A4'/%3E%3Ctext x='96' y='130' text-anchor='middle' font-size='100' fill='white'%3EğŸ“…%3C/text%3E%3C/svg%3E",sizes:'192x192',type:'image/svg+xml'}]};
const ml=document.createElement('link');ml.rel='manifest';ml.href=URL.createObjectURL(new Blob([JSON.stringify(mf)],{type:'application/manifest+json'}));document.head.appendChild(ml);

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  åˆå§‹åŒ–
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
renderBar();
render();
// æ‰“é–‹æ™‚ä¸è‡ªå‹•å½ˆå‡ºè©³æƒ…é¢æ¿ï¼Œé»æ“Šæ—¥æœŸæ‰é¡¯ç¤º
</script>
</body>
</html>
